<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     <link rel="stylesheet" href="/estiloAdmin.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>VerAuto</title>
</head>

<body>
    <header class="p-3 text-bg-dark header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-12 col-md-4 mb-3 mb-md-0 text-md-start">
                <ul class="nav justify-content-center fs-5">
                    <li class="nav-item">
                        <a href="" class="nav-link fw-bold text-white px-3">NOSOTROS</a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link fw-bold text-white px-3">AUTOS</a>
                    </li>
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center mb-3 mb-md-0">
                <a>
                    <img src="img/LOGOV.4.png" class="img-fluid" alt="Logo">
                </a>
            </div>
            <div class="col-12 col-md-4 text-center text-md-end">
                    <div>
                        <a href="" class="btn btn-outline-light btn-sm me-2">Iniciar sesión</a>
                        <a href="" class="btn btn-warning btn-sm me-2">Registrarse</a>
                    </div>
            </div>
        </div>
    </div>
</header>


     <div class="container-fluid ps-4 pe-4">
    <h1 class="fw-bold text-center p-3">ADMIN - AUTOS</h1>

       <h3 class="fw-bold mb-3">Autos:</h3>

   <div class="row  gy-2 gx-3 align-items-center flex-wrap g-4">
  

    <!--Buscar -->
    <div class="col-12 col-md-auto">
      <button type="button" class="btn btn-primary" onclick="pedirIdAuto()">
        <i class="fas fa-search"></i> Buscar Auto
      </button>
    </div>

    <div class="col-12 col-md-auto">
    <button type="button" class="btn btn-primary" onclick="listarAutos()">
      <i class="fas fa-book"></i> Listar Autos
    </button>
    </div>

  </div>
  <!--Listar -->
    
  
    <hr>
    </div>

    <div class="container-fluid ps-4 pe-4" id="boton_animacion">
    <div class="d-flex flex-wrap justify-content-between align-items-center">
    
    <!-- Boton a la izquierda -->
    <div class="d-flex flex-wrap gap-3 justify-content-start">
      <button type="button" class="btn btn-outline-success" onclick="InsertarAuto()">
        <i class="fas fa-plus"></i> Agregar Auto
      </button>
      
    </div>

    <!-- Botón a la derecha -->
    <div class="mt-3 mt-md-0">
      <a href="admin" class="btn btn-secondary p-3">
        <i class="fas fa-home"></i> Volver al Menú Principal
      </a>
    </div>

    </div>
    </div>

   <div id="tablaResultados"></div>

    <script>
  function listarAutos() {
  fetch('/api/autos')
    .then(response => response.json())
    .then(data => {
      let tabla = `
        <div class="table-responsive">
          <table class="table table-sm table-striped table-hover align-middle text-center">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Modelo</th>
                <th>Color</th>
                <th>Marca</th>
                <th>Año</th>
                <th>Precio</th>
                <th>Kilometraje</th>
                <th>Transmisión</th>
                <th>Combustible</th>
                <th>Equipamiento1</th>
                <th>Equipamiento2</th>
                <th>Equipamiento3</th>
                <th>Equipamiento4</th>
                <th>Imagen</th>
                <th>Categoría</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
      `;

      data.forEach(auto => {
        tabla += `
          <tr>
            <td>${auto.idAuto}</td>
            <td>${auto.modelo}</td>
            <td>${auto.color}</td>
            <td>${auto.marca}</td>
            <td>${auto.ano}</td>
            <td>${auto.precio}</td>
            <td>${auto.kilometraje}</td>
            <td>${auto.transmision}</td>
            <td>${auto.combustible}</td>
            <td>${auto.equipamiento1}</td>
            <td>${auto.equipamiento2}</td>
            <td>${auto.equipamiento3}</td>
            <td>${auto.equipamiento4}</td>
            <td><img src="${auto.imagen}" alt="Imagen Auto" style="max-width:100px;"></td>
            <td>${auto.categoria}</td>
            <td>${auto.estado}</td>
          </tr>
        `;
      });

      tabla += `
            </tbody>
          </table>
        </div>
      `;

      document.getElementById('tablaResultados').innerHTML = tabla;
    })
    .catch(error => {
      console.error('Error al listar autos:', error);
      alert('Error al cargar los autos.');
    });
    }
    
   
    function InsertarAuto() {
    Swal.fire({
        title: 'Insertar Auto',
        html: `
            <input id="modelo" class="swal2-input" placeholder="Modelo">
            <input id="color" class="swal2-input" placeholder="Color">
            <input id="marca" class="swal2-input" placeholder="Marca">
            <input id="ano" type="number" class="swal2-input" placeholder="Año">
            <input id="precio" type="number" step="0.01" class="swal2-input" placeholder="Precio">
            <input id="kilometraje" type="number" class="swal2-input" placeholder="Kilometraje">
            <input id="transmision" class="swal2-input" placeholder="Transmisión">
            <input id="combustible" class="swal2-input" placeholder="Combustible">
            <input id="equipamiento1" class="swal2-input" placeholder="Equipamiento 1">
            <input id="equipamiento2" class="swal2-input" placeholder="Equipamiento 2">
            <input id="equipamiento3" class="swal2-input" placeholder="Equipamiento 3">
            <input id="equipamiento4" class="swal2-input" placeholder="Equipamiento 4">
            <input id="imagen" class="swal2-input" placeholder="URL Imagen">
            <input id="categoria" class="swal2-input" placeholder="Categoría">
            <input id="estado" class="swal2-input" placeholder="Estado">
        `,
        confirmButtonText: 'Agregar',
         cancelButtonText: 'Cancelar',
        showCancelButton: true,
        preConfirm: () => {
            const precioValue = parseFloat(document.getElementById('precio').value);
            
            const data = {
                modelo: document.getElementById('modelo').value,
                color: document.getElementById('color').value,
                marca: document.getElementById('marca').value,
                ano: parseInt(document.getElementById('ano').value),
                precio: precioValue.toFixed(2), // Convertimos a string con dos decimales
                kilometraje: parseInt(document.getElementById('kilometraje').value),
                transmision: document.getElementById('transmision').value,
                combustible: document.getElementById('combustible').value,
                equipamiento1: document.getElementById('equipamiento1').value,
                equipamiento2: document.getElementById('equipamiento2').value,
                equipamiento3: document.getElementById('equipamiento3').value,
                equipamiento4: document.getElementById('equipamiento4').value,
                imagen: document.getElementById('imagen').value,
                categoria: document.getElementById('categoria').value,
                estado: document.getElementById('estado').value
            };

            return fetch('/api/autos', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            }).then(r => {
                if (!r.ok) throw new Error();
                Swal.fire('Éxito', 'Auto insertado correctamente', 'success');
                listarAutos(); // Asegúrate de tener esta función para refrescar la lista
            }).catch(() => Swal.fire('Error', 'No se pudo insertar el auto', 'error'));
        }
    });
}

function pedirIdAuto() {
  Swal.fire({
    title: 'Buscar Auto',
    input: 'number',
    inputLabel: 'Ingrese el ID del auto',
    inputPlaceholder: 'Ej. 12',
    showCancelButton: true,
    confirmButtonText: 'Buscar',
    cancelButtonText: 'Cancelar',
    inputValidator: (value) => {
      if (!value) {
        return 'Por favor ingrese un ID válido';
      }
    }
  }).then((result) => {
    if (result.isConfirmed) {
      buscarAutoPorId(result.value);
    }
  });
}


function buscarAutoPorId(id) {
  fetch(`/api/autos/${id}`)
    .then(response => {
      if (!response.ok) throw new Error("Auto no encontrado");
      return response.json();
    })
    .then(auto => {
      Swal.fire({
        title: `Auto ID: ${auto.idAuto}`,
        html: `
          <div class="text-center">
            <p><strong>Modelo:</strong> ${auto.modelo}</p>
            <p><strong>Color:</strong> ${auto.color}</p>
            <p><strong>Marca:</strong> ${auto.marca}</p>
            <p><strong>Año:</strong> ${auto.ano}</p>
            <p><strong>Precio:</strong> $${auto.precio}</p>
            <p><strong>Kilometraje:</strong> ${auto.kilometraje} km</p>
            <p><strong>Transmisión:</strong> ${auto.transmision}</p>
            <p><strong>Combustible:</strong> ${auto.combustible}</p>
            <p><strong>Equipamiento:</strong><br>
              - ${auto.equipamiento1}<br>
              - ${auto.equipamiento2}<br>
              - ${auto.equipamiento3}<br>
              - ${auto.equipamiento4}
            </p>
            <p><strong>Categoría:</strong> ${auto.categoria}</p>
            <p><strong>Estado:</strong> ${auto.estado}</p>
            <img src="${auto.imagen}" alt="Imagen Auto" style="width: 100%; max-width: 300px; border-radius: 10px; margin-top: 10px;">
          </div>
          <div class="d-flex justify-content-center mt-4 gap-3">
            <button id="btnEditar" class="btn btn-outline-warning">Editar Auto</button>
            <button id="btnEliminar" class="btn btn-outline-danger">Eliminar Auto</button>
            <button id="btnVolver" class="btn btn-outline-secondary">Volver</button>
          </div>
        `,
        showConfirmButton: false,
        showCancelButton: false,
        width: 700,
        didOpen: () => {
          document.getElementById('btnEditar').addEventListener('click', () => editarAuto(auto));
          document.getElementById('btnEliminar').addEventListener('click', () => eliminarAuto(auto.idAuto));
          document.getElementById('btnVolver').addEventListener('click', () => Swal.close());
        }
      });
    })
    .catch(error => {
      console.error('Error al buscar auto:', error);
      Swal.fire('No encontrado', 'No se encontró ningún auto con ese ID.', 'warning');
    });
}


function editarAuto(auto) {
  Swal.fire({
    title: 'Editar Auto',
    html: `
      <input id="modeloEdit" class="swal2-input" placeholder="Modelo" value="${auto.modelo}">
      <input id="colorEdit" class="swal2-input" placeholder="Color" value="${auto.color}">
      <input id="marcaEdit" class="swal2-input" placeholder="Marca" value="${auto.marca}">
      <input id="anoEdit" type="number" class="swal2-input" placeholder="Año" value="${auto.ano}">
      <input id="precioEdit" type="number" step="0.01" class="swal2-input" placeholder="Precio" value="${auto.precio}">
      <input id="kilometrajeEdit" type="number" class="swal2-input" placeholder="Kilometraje" value="${auto.kilometraje}">
      <input id="transmisionEdit" class="swal2-input" placeholder="Transmisión" value="${auto.transmision}">
      <input id="combustibleEdit" class="swal2-input" placeholder="Combustible" value="${auto.combustible}">
      <input id="equipamiento1Edit" class="swal2-input" placeholder="Equipamiento 1" value="${auto.equipamiento1}">
      <input id="equipamiento2Edit" class="swal2-input" placeholder="Equipamiento 2" value="${auto.equipamiento2}">
      <input id="equipamiento3Edit" class="swal2-input" placeholder="Equipamiento 3" value="${auto.equipamiento3}">
      <input id="equipamiento4Edit" class="swal2-input" placeholder="Equipamiento 4" value="${auto.equipamiento4}">
      <input id="imagenEdit" class="swal2-input" placeholder="URL Imagen" value="${auto.imagen}">
      <input id="categoriaEdit" class="swal2-input" placeholder="Categoría" value="${auto.categoria}">
      <input id="estadoEdit" class="swal2-input" placeholder="Estado" value="${auto.estado}">
    `,
    showCancelButton: true,
    confirmButtonText: 'Guardar Cambios',
    cancelButtonText: 'Cancelar',
    preConfirm: () => {
      const autoEditado = {
        idAuto: auto.idAuto,
        modelo: document.getElementById('modeloEdit').value,
        color: document.getElementById('colorEdit').value,
        marca: document.getElementById('marcaEdit').value,
        ano: parseInt(document.getElementById('anoEdit').value),
        precio: parseFloat(document.getElementById('precioEdit').value),
        kilometraje: parseInt(document.getElementById('kilometrajeEdit').value),
        transmision: document.getElementById('transmisionEdit').value,
        combustible: document.getElementById('combustibleEdit').value,
        equipamiento1: document.getElementById('equipamiento1Edit').value,
        equipamiento2: document.getElementById('equipamiento2Edit').value,
        equipamiento3: document.getElementById('equipamiento3Edit').value,
        equipamiento4: document.getElementById('equipamiento4Edit').value,
        imagen: document.getElementById('imagenEdit').value,
        categoria: document.getElementById('categoriaEdit').value,
        estado: document.getElementById('estadoEdit').value
      };

      return fetch(`/api/autos/${auto.idAuto}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(autoEditado)
      })
      .then(response => {
        if (!response.ok) throw new Error('Error al editar');
        Swal.fire('Éxito', 'Auto editado correctamente', 'success');
        listarAutos(); // actualiza la lista si estás mostrando todos
      })
      .catch(() => {
        Swal.fire('Error', 'No se pudo editar el auto', 'error');
      });
    }
  });
}

function eliminarAuto(id) {
  Swal.fire({
    title: '¿Estás seguro?',
    text: "Esta acción no se puede deshacer.",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar',
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/api/autos/${id}`, { method: 'DELETE' })
        .then(response => {
          if (!response.ok) throw new Error();
          Swal.fire('Eliminado', 'El auto ha sido eliminado.', 'success');
          listarAutos();
        })
        .catch(() => Swal.fire('Error', 'No se pudo eliminar el auto.', 'error'));
    }
  });
}

</script>
   

    

     
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>

</html>