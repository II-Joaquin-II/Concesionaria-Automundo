<!doctype html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Resumen de Pedido | Mundo Pan</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            body {
                background-color: #fdf7ed;
            }
            .sidebar h5 {
                color: #0a5d31;
            }
            .price {
                color: #127143;
                font-weight: bold;
            }
            header {
                background-color: #b68d40;
                color: white;
                padding: 15px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            nav ul {
                list-style: none;
                display: flex;
                gap: 20px;
            }
            nav ul li a {
                color: white;
                text-decoration: none;
                font-weight: 500;
            }
            footer {
                background-color: #b68d40;
                color: white;
                padding: 20px;
                font-family: Arial, sans-serif;
            }
            .footer-container {
                display: flex;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            .footer-col {
                flex: 1;
                min-width: 200px;
                margin: 10px;
            }
            .footer-col h4 {
                margin-bottom: 10px;
                font-size: 18px;
            }
            .footer-col ul {
                list-style: none;
                padding: 0;
            }
            .footer-col li {
                margin-bottom: 8px;
                display: flex;
                align-items: center;
            }
            .logo-footer {
                width: 120px;
                height: auto;
                border-radius: 15px;
            }
            .icono-whatsapp {
                width: 20px;
                height: 20px;
                margin-right: 8px;
            }
            .footer-copy {
                text-align: center;
                margin-top: 30px;
                font-size: 14px;
                padding-top: 10px;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="logo"> Mundo Pan</div>
            <nav>
                <ul>
                    <li><a href="inicio">Inicio</a></li>
                    <li><a href="listapanes">Productos</a></li>
                    <li><a href="carritocompras">Carrito de Compras</a></li>
                    <li><a href="preguntasfrecuentes">Preguntas Frecuentes</a></li>
                    <a th:href="@{/RegistroPedido}" sec:authorize="isAuthenticated()">Mis Pedidos</a>
                </ul>
            </nav>
            <div>
           <span th:text="'Bienvenido, ' + ${nombreCliente}"></span>
            <a href="/logout" class="btn btn-outline-danger btn-sm ms-3">Cerrar sesión</a>
        </div>
        </header>

        <div class="container py-5">
            <h1 class="mb-4 text-center">¡Gracias por tu compra!</h1>

            <div id="pedidos-container">
            
        </div>
        </div>

        <footer>
            <div class="footer-container">
                <div class="footer-col">
                    <img src="img/logoMundoPan.jpg" alt="Logo MundoPan" class="logo-footer">
                </div>
                <div class="footer-col">
                    <h4>Envíos y garantías</h4>
                    <ul>
                        <li>¿Cómo comprar?</li>
                        <li>Envíos</li>
                        <li>Términos y condiciones de Garantía</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>¿Quiénes somos?</h4>
                    <ul>
                        <li>Nuestra tienda</li>
                        <li>Privacidad</li>
                        <li><a href="reclamos">Libro de Reclamaciones</a></li>
                        <li><a href="preguntasfrecuentes">Preguntas Frecuentes</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contacto</h4>
                    <ul>
                        <li>
                            <img src="https://img.icons8.com/?size=100&id=16713&format=png&color=000000" alt="WhatsApp" class="icono-whatsapp">
                            Asesor de ventas
                        </li>
                        <li>
                            <img src="https://img.icons8.com/?size=100&id=16713&format=png&color=000000" alt="WhatsApp" class="icono-whatsapp">
                            Área de garantía
                        </li>
                    </ul>
                </div>
            </div>
            <div class="footer-copy">
                &copy; Mundo Pan 2025
            </div>  
        </footer>
        
       <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/adminventas/mis-pedidos');
                if (!res.ok) throw new Error("Debes iniciar sesión para ver tus pedidos.");
                const pedidos = await res.json();

                const container = document.getElementById('pedidos-container');

                if (pedidos.length === 0) {
                    container.innerHTML = '<p class="text-center">No tienes pedidos aún.</p>';
                    return;
                }

                pedidos.forEach(pedido => {
                    // Crear tarjeta
                    const card = document.createElement('div');
                    card.className = 'card shadow-sm mb-4';

                    // Card header
                    const cardHeader = document.createElement('div');
                    cardHeader.className = 'card-header bg-primary text-white';
                    cardHeader.textContent = `Pedido #${pedido.id} - Fecha: ${pedido.fecha.substring(0,10)}`;
                    card.appendChild(cardHeader);

                    // Card body
                    const cardBody = document.createElement('div');
                    cardBody.className = 'card-body';

                    // Estado del pedido
                    const estadoP = document.createElement('p');
                    estadoP.innerHTML = `<strong>Estado:</strong> ${pedido.estado}`;
                    cardBody.appendChild(estadoP);

                    // Tabla con items
                    const tabla = document.createElement('table');
                    tabla.className = 'table';

                    tabla.innerHTML = `
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pedido.items.map(item => `
                                <tr>
                                    <td>${item.nombreProducto}</td>
                                    <td>${item.cantidad}</td>
                                    <td>S/. ${item.precioUnitario.toFixed(2)}</td>
                                    <td>S/. ${(item.cantidad * item.precioUnitario).toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    `;
                    cardBody.appendChild(tabla);

                    // Total pedido
                    const totalP = document.createElement('p');
                    totalP.className = 'text-end fw-bold fs-5 price';
                    const totalCalculado = pedido.items.reduce((acc, i) => acc + i.cantidad * i.precioUnitario, 0);
                    totalP.innerHTML = `Total a pagar: S/. ${totalCalculado.toFixed(2)}`;
                    cardBody.appendChild(totalP);

                    // Botones
                    const botonesDiv = document.createElement('div');
                    botonesDiv.className = 'd-flex justify-content-end gap-2 mt-3';

                    const btnImprimir = document.createElement('button');
                    btnImprimir.className = 'btn btn-success';
                    btnImprimir.textContent = 'Imprimir Recibo';
                    btnImprimir.onclick = () => window.print();

                    const btnPDF = document.createElement('button');
                    btnPDF.className = 'btn btn-primary';
                    btnPDF.textContent = 'Descargar PDF';
                    btnPDF.disabled = true; // Lo dejamos deshabilitado igual que tu original

                    botonesDiv.appendChild(btnImprimir);
                    botonesDiv.appendChild(btnPDF);
                    cardBody.appendChild(botonesDiv);

                    // Mensaje info
                    const alertInfo = document.createElement('div');
                    alertInfo.className = 'alert alert-info mt-4 mb-0';
                    alertInfo.textContent = 'Recibirás un correo con los detalles y la fecha estimada de entrega.';
                    cardBody.appendChild(alertInfo);

                    card.appendChild(cardBody);

                    container.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                alert(err.message);
            }
        });
    </script>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>